var abi = [{"constant":false,"inputs":[],"name":"acceptClaim","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"claimId","type":"uint256"}],"name":"getMoneyAsJudge","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"}],"name":"getMoneyAsEmployee","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_employer","type":"address"},{"name":"idx","type":"uint256"}],"name":"getProposalForEmployer","outputs":[{"name":"proposalId","type":"uint256"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"}],"name":"acceptProposal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_employer","type":"address"}],"name":"getProposalsLengthForEmployer","outputs":[{"name":"length","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"proposalId","type":"uint256"}],"name":"getProposalData","outputs":[{"name":"name","type":"string"},{"name":"employer","type":"address"},{"name":"employee","type":"address"},{"name":"taskDescription","type":"string"},{"name":"price","type":"uint256"},{"name":"taskSolution","type":"string"},{"name":"deadlineWorkDate","type":"uint256"},{"name":"deadLineClaimDate","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"},{"name":"isEmployerInFavor","type":"bool"}],"name":"decideClaimByProposal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_name","type":"string"},{"name":"_taskDescription","type":"string"},{"name":"_numJudges","type":"uint8"},{"name":"daysToDeadline","type":"uint256"},{"name":"daysToClaimDeadline","type":"uint256"},{"name":"daysToVoteDeadline","type":"uint256"},{"name":"_daysForIndividualVote","type":"uint256"},{"name":"_employee","type":"address"}],"name":"createProposal","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"_employee","type":"address"}],"name":"getProposalsLengthForEmployee","outputs":[{"name":"length","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_employee","type":"address"},{"name":"idx","type":"uint256"}],"name":"getProposalForEmployee","outputs":[{"name":"proposalId","type":"uint256"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_judge","type":"address"},{"name":"idx","type":"uint256"}],"name":"getProposalForJudge","outputs":[{"name":"proposalId","type":"uint256"},{"name":"name","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"},{"name":"isEmployerInFavor","type":"bool"}],"name":"decideClaim","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_judge","type":"address"}],"name":"getProposalsLengthForJudge","outputs":[{"name":"length","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"}],"name":"getMoneyAsEmployer","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"getNewClaim","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"proposalId","type":"uint256"},{"name":"_taskSolution","type":"string"}],"name":"updateSolution","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_proposalId","type":"uint256"},{"name":"_message","type":"string"}],"name":"openClaim","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"},{"indexed":false,"name":"proposalId","type":"uint256"}],"name":"createProposalResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"updateSolutionResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"acceptProposalResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"},{"indexed":false,"name":"claimId","type":"uint256"}],"name":"openClaimResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"},{"indexed":false,"name":"clainId","type":"uint256"}],"name":"getNewClaimResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"acceptClaimResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"decideClaimResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"getMoneyAsEmployerResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"getMoneyAsEmployeeResult","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"success","type":"bool"}],"name":"getMoneyAsJudgeResult","type":"event"}];
var Web3 = require('web3');
var web3 = new Web3();
web3.setProvider(new web3.providers.HttpProvider('http://127.0.0.1:8545'));
var contract = web3.eth.contract(abi).at('0x1ffB8accd6d248f36bD2Fa56821C76b42dEF7B5D');

function getParam(url, param) {
    if (!url) url = window.location.search;
    var regex = new RegExp("[?&]" + param + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return results[2];
}

function getFrom(url) {
    return getParam(url, "from");
}

function getProposalId(url) {
    return getParam(url, "pid");
}

function watchEvents(callback) {
    var latest = web3.eth.getBlock('latest').number;
    contract.allEvents().watch(function (error, event) {
        if (event.blockNumber > latest) {
            callback(error, event);
        }
    });
}
